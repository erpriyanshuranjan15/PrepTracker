!DOCTYPE html>
<html lang="en">
<head>
<script src="auth.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrepTracker â€“ Skills</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<nav class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon">PT</div>
    <span class="logo-text">PrepTracker</span>
  </div>
  <ul class="nav-links">
    <li><a href="index.html" class="nav-item"><span class="nav-icon">â¬¡</span><span>Dashboard</span></a></li>
    <li><a href="skills.html" class="nav-item active"><span class="nav-icon">â—ˆ</span><span>Skills</span></a></li>
    <li><a href="goals.html" class="nav-item"><span class="nav-icon">â—</span><span>Daily Goals</span></a></li>
    <li><a href="companies.html" class="nav-item"><span class="nav-icon">â—·</span><span>Companies</span></a></li>
    <li><a href="resume.html" class="nav-item"><span class="nav-icon">â—»</span><span>Resume</span></a></li>
    <li><a href="notes.html" class="nav-item"><span class="nav-icon">â—ˆ</span><span>Notes</span></a></li>
  </ul>
  <div class="sidebar-footer" style="flex-direction:column;align-items:flex-start;gap:8px">
    <div style="display:flex;align-items:center;gap:10px">
      <div class="user-avatar">AS</div>
      <div class="user-info">
        <span class="user-name">Aryan Singh</span>
        <span class="user-role">B.Tech CSE Â· 2025</span>
      </div>
    </div>
    <button class="logout-btn" onclick="logout()">â‹ Sign Out</button>
  </div>
</nav>

<main class="main-content">
  <header class="top-header">
    <div class="header-left">
      <button class="menu-btn" onclick="toggleSidebar()">â˜°</button>
      <div>
        <h1 class="page-title">Skills Tracker</h1>
        <p class="page-sub">Monitor your preparation across all domains</p>
      </div>
    </div>
    <div class="header-right">
      <div class="streak-badge">ğŸ”¥ 12 Day Streak</div>
    </div>
  </header>

  <!-- Overview Charts -->
  <div style="display:grid;grid-template-columns:1fr 1fr 1fr;gap:20px;margin-bottom:28px;">
    <div class="chart-card" style="grid-column:span 2">
      <div class="chart-header">
        <h3>Skills Progress Overview</h3>
        <span class="chart-sub">Current vs Target</span>
      </div>
      <canvas id="skillBarChart" height="130"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-header">
        <h3>Readiness Breakdown</h3>
      </div>
      <canvas id="readinessDoughnut" height="170"></canvas>
      <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:12px;">
        <span class="pill pill-green" style="font-size:11px;">Technical 78%</span>
        <span class="pill pill-yellow" style="font-size:11px;">Aptitude 65%</span>
        <span class="pill pill-blue" style="font-size:11px;">Soft 82%</span>
      </div>
    </div>
  </div>

  <!-- Skill Categories -->
  <div class="skills-grid">
    <!-- DSA -->
    <div class="skill-category-card">
      <div class="skill-cat-header">
        <div class="skill-cat-icon" style="background:rgba(122,63,145,0.2)">ğŸ§®</div>
        <div>
          <div class="skill-cat-title">Data Structures & Algorithms</div>
          <div class="skill-cat-count">12 skills Â· avg 73%</div>
        </div>
      </div>
      <div id="dsa-skills"></div>
    </div>

    <!-- System Design -->
    <div class="skill-category-card">
      <div class="skill-cat-header">
        <div class="skill-cat-icon" style="background:rgba(155,89,201,0.2)">ğŸ—ï¸</div>
        <div>
          <div class="skill-cat-title">System Design</div>
          <div class="skill-cat-count">8 skills Â· avg 58%</div>
        </div>
      </div>
      <div id="sd-skills"></div>
    </div>

    <!-- CS Fundamentals -->
    <div class="skill-category-card">
      <div class="skill-cat-header">
        <div class="skill-cat-icon" style="background:rgba(59,130,246,0.15)">ğŸ’»</div>
        <div>
          <div class="skill-cat-title">CS Fundamentals</div>
          <div class="skill-cat-count">10 skills Â· avg 76%</div>
        </div>
      </div>
      <div id="cs-skills"></div>
    </div>

    <!-- Aptitude -->
    <div class="skill-category-card">
      <div class="skill-cat-header">
        <div class="skill-cat-icon" style="background:rgba(245,158,11,0.15)">ğŸ”¢</div>
        <div>
          <div class="skill-cat-title">Aptitude & Quant</div>
          <div class="skill-cat-count">7 skills Â· avg 65%</div>
        </div>
      </div>
      <div id="apt-skills"></div>
    </div>

    <!-- Soft Skills -->
    <div class="skill-category-card">
      <div class="skill-cat-header">
        <div class="skill-cat-icon" style="background:rgba(34,197,94,0.15)">ğŸ—£ï¸</div>
        <div>
          <div class="skill-cat-title">Soft Skills</div>
          <div class="skill-cat-count">6 skills Â· avg 82%</div>
        </div>
      </div>
      <div id="soft-skills"></div>
    </div>

    <!-- Skill Trends -->
    <div class="skill-category-card">
      <div class="skill-cat-header">
        <div class="skill-cat-icon" style="background:rgba(78,205,196,0.15)">ğŸ“ˆ</div>
        <div>
          <div class="skill-cat-title">Monthly Trend</div>
          <div class="skill-cat-count">Last 6 months</div>
        </div>
      </div>
      <canvas id="trendChart" height="160"></canvas>
    </div>
  </div>

  <!-- Skill Checklist -->
  <div class="chart-card" style="margin-top:24px;">
    <div class="chart-header">
      <h3>Core Topics Checklist</h3>
      <span class="chart-sub">Mark topics as completed</span>
    </div>
    <div id="checklist-grid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:4px;"></div>
  </div>
</main>

<script>
const skills = {
  dsa: [
    {name:'Arrays & Strings', pct:90, color:'#7A3F91'},
    {name:'Trees & Graphs', pct:75, color:'#7A3F91'},
    {name:'DP', pct:60, color:'#7A3F91'},
    {name:'Backtracking', pct:65, color:'#7A3F91'},
    {name:'Linked Lists', pct:85, color:'#7A3F91'},
  ],
  sd: [
    {name:'Load Balancing', pct:55, color:'#C59DD9'},
    {name:'Caching', pct:65, color:'#C59DD9'},
    {name:'Databases', pct:70, color:'#C59DD9'},
    {name:'Microservices', pct:45, color:'#C59DD9'},
    {name:'Message Queues', pct:40, color:'#C59DD9'},
  ],
  cs: [
    {name:'Operating Systems', pct:80, color:'#3b82f6'},
    {name:'DBMS', pct:85, color:'#3b82f6'},
    {name:'Computer Networks', pct:70, color:'#3b82f6'},
    {name:'OOP Concepts', pct:88, color:'#3b82f6'},
    {name:'Compiler Design', pct:55, color:'#3b82f6'},
  ],
  apt: [
    {name:'Quantitative', pct:70, color:'#E8C36A'},
    {name:'Logical Reasoning', pct:72, color:'#E8C36A'},
    {name:'Verbal Ability', pct:68, color:'#E8C36A'},
    {name:'Data Interpretation', pct:55, color:'#E8C36A'},
  ],
  soft: [
    {name:'Communication', pct:88, color:'#5ECEA0'},
    {name:'Leadership', pct:75, color:'#5ECEA0'},
    {name:'Problem Solving', pct:90, color:'#5ECEA0'},
    {name:'Teamwork', pct:85, color:'#5ECEA0'},
  ]
};

function renderSkills(containerId, arr) {
  const el = document.getElementById(containerId);
  el.innerHTML = arr.map(s => `
    <div class="skill-item">
      <div class="skill-row">
        <span style="font-size:13px">${s.name}</span>
        <span class="skill-pct" style="color:${s.color}">${s.pct}%</span>
      </div>
      <div class="skill-bar-bg">
        <div class="skill-bar-fill" style="width:${s.pct}%;background:${s.color}"></div>
      </div>
    </div>
  `).join('');
}

renderSkills('dsa-skills', skills.dsa);
renderSkills('sd-skills', skills.sd);
renderSkills('cs-skills', skills.cs);
renderSkills('apt-skills', skills.apt);
renderSkills('soft-skills', skills.soft);

// Bar chart
new Chart(document.getElementById('skillBarChart'), {
  type: 'bar',
  data: {
    labels: ['Arrays','Trees','DP','Backtrack','Linked List','Load Bal.','Caching','OS','DBMS','Networks'],
    datasets: [
      { label: 'Current', data: [90,75,60,65,85,55,65,80,85,70], backgroundColor: '#7A3F91', borderRadius: 6 },
      { label: 'Target', data: [95,90,85,80,90,85,85,90,90,85], backgroundColor: '#2a2a3e', borderRadius: 6, borderWidth: 1, borderColor: '#C59DD9' }
    ]
  },
  options: {
    plugins: { legend: { labels: { color: '#C59DD9', boxWidth: 10 } } },
    scales: {
      x: { grid: { display: false }, ticks: { color: 'rgba(197,157,217,0.45)', font: { size: 11 } } },
      y: { grid: { color: 'rgba(197,157,217,0.08)' }, ticks: { color: 'rgba(197,157,217,0.45)' }, max: 100 }
    }
  }
});

// Doughnut
new Chart(document.getElementById('readinessDoughnut'), {
  type: 'doughnut',
  data: {
    labels: ['Technical','Aptitude','Soft Skills'],
    datasets: [{ data: [78,65,82], backgroundColor: ['#7A3F91','#E8C36A','#5ECEA0'], borderWidth: 2, borderColor: '#1A0828' }]
  },
  options: { plugins: { legend: { display: false } }, cutout: '65%' }
});

// Trend
new Chart(document.getElementById('trendChart'), {
  type: 'line',
  data: {
    labels: ['Sep','Oct','Nov','Dec','Jan','Feb'],
    datasets: [
      { label: 'Technical', data: [55,60,65,70,74,78], borderColor: '#7A3F91', tension: 0.4, fill: false, pointRadius: 3 },
      { label: 'Aptitude', data: [45,50,55,58,62,65], borderColor: '#E8C36A', tension: 0.4, fill: false, pointRadius: 3 },
      { label: 'Soft', data: [70,72,75,78,80,82], borderColor: '#5ECEA0', tension: 0.4, fill: false, pointRadius: 3 }
    ]
  },
  options: {
    plugins: { legend: { labels: { color: '#C59DD9', boxWidth: 10, font: { size: 11 } } } },
    scales: {
      x: { grid: { display: false }, ticks: { color: 'rgba(197,157,217,0.45)', font: { size: 11 } } },
      y: { grid: { color: 'rgba(197,157,217,0.08)' }, ticks: { color: 'rgba(197,157,217,0.45)' }, min: 40, max: 100 }
    }
  }
});

// Checklist
const topics = [
  'Arrays','Sorting','BFS/DFS','Heaps','Tries','Segment Trees','Kadane\'s','Two Pointers',
  'Binary Search','Sliding Window','Union Find','Floyd\'s Cycle','KMP Algorithm','Z-algorithm',
  'Topological Sort','Dijkstra\'s','Bellman-Ford','Floyd-Warshall','Knapsack','LCS'
];

let checkedTopics = {};

async function loadTopics() {
  const res = await fetch('/api/skills/topics');
  checkedTopics = await res.json();
  renderTopicsGrid();
}

function renderTopicsGrid() {
  const grid = document.getElementById('checklist-grid');
  if (!grid) return;
  grid.innerHTML = topics.map((t, i) => `
    <label class="topic-item" style="display:flex;align-items:center;gap:8px;padding:10px 14px;background:var(--surface2);border-radius:10px;cursor:pointer;border:1px solid var(--border);transition:border-color 0.2s">
      <input type="checkbox" id="chk-${i}" ${checkedTopics[t] ? 'checked' : ''} onchange="toggleTopic('${t}', this.checked)" style="accent-color:#C59DD9;width:14px;height:14px">
      <span id="chk-lbl-${i}" style="${checkedTopics[t] ? 'text-decoration:line-through;color:#555' : ''}">${t}</span>
    </label>
  `).join('');
}




async function toggleTopic(name, checked) {
  checkedTopics[name] = checked;
  await fetch('/api/skills/topics', {
    method: 'PUT',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify(checkedTopics)
  });
  // Update label style
  const idx = topics.indexOf(name);
  const lbl = document.getElementById(`chk-lbl-${idx}`);
  if (lbl) lbl.style.cssText = checked ? 'text-decoration:line-through;color:#555' : '';
}

loadTopics();
</script>
<script src="theme-switcher.js"></script>
</body>
</html>