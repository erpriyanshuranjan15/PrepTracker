!DOCTYPE html>
<html lang="en">
<head>
<script src="auth.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrepTracker â€“ Notes</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="styles.css">
</head>
<body>
<nav class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon">PT</div>
    <span class="logo-text">PrepTracker</span>
  </div>
  <ul class="nav-links">
    <li><a href="index.html" class="nav-item"><span class="nav-icon">â¬¡</span><span>Dashboard</span></a></li>
    <li><a href="skills.html" class="nav-item"><span class="nav-icon">â—ˆ</span><span>Skills</span></a></li>
    <li><a href="goals.html" class="nav-item"><span class="nav-icon">â—Ž</span><span>Daily Goals</span></a></li>
    <li><a href="companies.html" class="nav-item"><span class="nav-icon">â—·</span><span>Companies</span></a></li>
    <li><a href="resume.html" class="nav-item"><span class="nav-icon">â—»</span><span>Resume</span></a></li>
    <li><a href="notes.html" class="nav-item active"><span class="nav-icon">â—ˆ</span><span>Notes</span></a></li>
  </ul>
  <div class="sidebar-footer" style="flex-direction:column;align-items:flex-start;gap:8px">
    <div style="display:flex;align-items:center;gap:10px">
      <div class="user-avatar">AS</div>
      <div class="user-info">
        <span class="user-name">Aryan Singh</span>
        <span class="user-role">B.Tech CSE Â· 2025</span>
      </div>
    </div>
    <button class="logout-btn" onclick="logout()">âŽ‹ Sign Out</button>
  </div>
</nav>

<main class="main-content">
  <header class="top-header">
    <div class="header-left">
      <button class="menu-btn" onclick="toggleSidebar()">â˜°</button>
      <div>
        <h1 class="page-title">Prep Notes</h1>
        <p class="page-sub">Your personal knowledge base for placements</p>
      </div>
    </div>
    <div class="header-right">
      <button class="btn-primary" onclick="newNote()">+ New Note</button>
    </div>
  </header>

  <div class="notes-layout">
    <!-- Notes List -->
    <div>
      <div class="notes-sidebar-panel">
        <input type="text" class="form-input" placeholder="ðŸ” Search notes..." id="search-notes" oninput="filterNotes(this.value)">
        
        <!-- Tags -->
        <div style="display:flex;flex-wrap:wrap;gap:6px;margin-top:14px;">
          <span class="g-tag dsa" style="cursor:pointer" onclick="filterByTag('DSA')">DSA</span>
          <span class="g-tag sd" style="cursor:pointer" onclick="filterByTag('System Design')">SD</span>
          <span class="g-tag cs" style="cursor:pointer" onclick="filterByTag('CS')">CS</span>
          <span class="g-tag apt" style="cursor:pointer" onclick="filterByTag('Aptitude')">APT</span>
          <span class="g-tag hr" style="cursor:pointer" onclick="filterByTag('HR')">HR</span>
        </div>

        <ul class="notes-list" id="notes-list"></ul>
      </div>
    </div>

    <!-- Editor -->
    <div class="notes-editor">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:8px;">
        <select class="form-select" id="note-tag" style="width:auto;font-size:12px;padding:6px 10px">
          <option>DSA</option>
          <option>System Design</option>
          <option>CS Fundamentals</option>
          <option>Aptitude</option>
          <option>HR</option>
          <option>Company Specific</option>
          <option>General</option>
        </select>
        <span id="note-save-status" style="font-size:12px;color:#22c55e;opacity:0">âœ“ Saved</span>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button class="btn-secondary" style="font-size:12px;padding:6px 12px" onclick="deleteCurrentNote()">ðŸ—‘ Delete</button>
          <button class="btn-primary" style="font-size:12px;padding:6px 12px" onclick="saveNote()">Save</button>
        </div>
      </div>
      <input type="text" class="note-title-input" id="note-title" placeholder="Note title...">
      <textarea class="note-body-input" id="note-body" placeholder="Start writing your prep notes here...

Use this space to jot down algorithms, key concepts, interview tips, company-specific notes, and anything that helps you prepare better.

Tips:
- Break down complex topics into smaller points
- Add examples and code snippets
- Mark important sections with capitals
- Review notes the night before an interview" oninput="autoSave()"></textarea>
    </div>
  </div>
</main>

<script>
const API = '/api/notes';
let notes = [];
let currentNoteId = null;

async function loadNotes() {
  const res = await fetch(API);
  notes = await res.json();
  renderNotesList();
  if (notes.length) openNote(notes[0].id);
}

function renderNotesList(filtered = notes) {
  const list = document.getElementById('notes-list');
  list.innerHTML = filtered.map(n => `
    <li class="note-list-item ${n.id === currentNoteId ? 'active' : ''}" onclick="openNote(${n.id})">
      <div class="note-list-title">${n.title}</div>
      <div class="note-list-preview" style="display:flex;gap:6px;align-items:center">
        <span class="g-tag ${getTagClass(n.tag)}" style="font-size:9px">${n.tag}</span>
        <span>${n.date}</span>
      </div>
    </li>
  `).join('');
}

function getTagClass(tag) {
  const map = {'DSA':'dsa','System Design':'sd','CS Fundamentals':'cs','Aptitude':'apt','HR':'hr','Company Specific':'hr','General':'cs'};
  return map[tag] || 'cs';
}

function openNote(id) {
  const n = notes.find(x => x.id === id);
  if (!n) return;
  currentNoteId = id;
  document.getElementById('note-title').value = n.title;
  document.getElementById('note-body').value = n.body;
  document.getElementById('note-tag').value = n.tag;
  renderNotesList();
}

async function saveNote() {
  const n = notes.find(x => x.id === currentNoteId);
  if (!n) return;
  n.title = document.getElementById('note-title').value;
  n.body = document.getElementById('note-body').value;
  n.tag = document.getElementById('note-tag').value;
  n.date = new Date().toLocaleDateString('en-US', {month:'short',day:'numeric',year:'numeric'});
  await fetch(`${API}/${currentNoteId}`, {
    method: 'PUT',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({title: n.title, body: n.body, tag: n.tag, date: n.date})
  });
  renderNotesList();
  showSaved();
}

let saveTimer;
function autoSave() {
  clearTimeout(saveTimer);
  saveTimer = setTimeout(saveNote, 1500);
}

function showSaved() {
  const s = document.getElementById('note-save-status');
  s.style.opacity = '1';
  setTimeout(() => s.style.opacity = '0', 2000);
}

async function newNote() {
  const res = await fetch(API, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({title: 'New Note', tag: 'General', body: ''})
  });
  const note = await res.json();
  notes.unshift(note);
  currentNoteId = note.id;
  renderNotesList();
  openNote(note.id);
  document.getElementById('note-title').focus();
  document.getElementById('note-title').select();
}

async function deleteCurrentNote() {
  if (!confirm('Delete this note?')) return;
  await fetch(`${API}/${currentNoteId}`, { method: 'DELETE' });
  notes = notes.filter(n => n.id !== currentNoteId);
  if (notes.length) openNote(notes[0].id);
  else { currentNoteId = null; document.getElementById('note-title').value = ''; document.getElementById('note-body').value = ''; }
  renderNotesList();
}

function filterNotes(q) {
  const filtered = notes.filter(n => n.title.toLowerCase().includes(q.toLowerCase()) || n.body.toLowerCase().includes(q.toLowerCase()));
  renderNotesList(filtered);
}

function filterByTag(tag) {
  renderNotesList(notes.filter(n => n.tag === tag));
}

loadNotes();
</script>
<script src="theme-switcher.js"></script>
</body>
</html>