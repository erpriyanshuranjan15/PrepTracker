!DOCTYPE html>
<html lang="en">
<head>
<script src="auth.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PrepTracker ‚Äì Daily Goals</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<nav class="sidebar" id="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon">PT</div>
    <span class="logo-text">PrepTracker</span>
  </div>
  <ul class="nav-links">
    <li><a href="index.html" class="nav-item"><span class="nav-icon">‚¨°</span><span>Dashboard</span></a></li>
    <li><a href="skills.html" class="nav-item"><span class="nav-icon">‚óà</span><span>Skills</span></a></li>
    <li><a href="goals.html" class="nav-item active"><span class="nav-icon">‚óé</span><span>Daily Goals</span></a></li>
    <li><a href="companies.html" class="nav-item"><span class="nav-icon">‚ó∑</span><span>Companies</span></a></li>
    <li><a href="resume.html" class="nav-item"><span class="nav-icon">‚óª</span><span>Resume</span></a></li>
    <li><a href="notes.html" class="nav-item"><span class="nav-icon">‚óà</span><span>Notes</span></a></li>
  </ul>
  <div class="sidebar-footer" style="flex-direction:column;align-items:flex-start;gap:8px">
    <div style="display:flex;align-items:center;gap:10px">
      <div class="user-avatar">AS</div>
      <div class="user-info">
        <span class="user-name">Aryan Singh</span>
        <span class="user-role">B.Tech CSE ¬∑ 2025</span>
      </div>
    </div>
    <button class="logout-btn" onclick="logout()">‚éã Sign Out</button>
  </div>
</nav>

<main class="main-content">
  <header class="top-header">
    <div class="header-left">
      <button class="menu-btn" onclick="toggleSidebar()">‚ò∞</button>
      <div>
        <h1 class="page-title">Daily Goals</h1>
        <p class="page-sub">Stay consistent. Build the habit.</p>
      </div>
    </div>
    <div class="header-right">
      <div class="streak-badge">üî• 12 Day Streak</div>
      <button class="btn-primary" onclick="openModal()">+ Add Goal</button>
    </div>
  </header>

  <!-- Stats Row -->
  <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:24px;">
    <div class="stat-card">
      <div class="stat-icon" style="background:rgba(122,63,145,0.3)">‚úÖ</div>
      <div class="stat-val" id="done-count">18</div>
      <div class="stat-lbl">Completed Today</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:rgba(232,195,106,0.2)">‚è≥</div>
      <div class="stat-val" id="pending-count">7</div>
      <div class="stat-lbl">Pending</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:rgba(155,89,201,0.3)">üî•</div>
      <div class="stat-val">12</div>
      <div class="stat-lbl">Day Streak</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon" style="background:rgba(94,206,160,0.2)">üìä</div>
      <div class="stat-val">72%</div>
      <div class="stat-lbl">Weekly Completion</div>
    </div>
  </div>

  <!-- Progress + Heatmap -->
  <div style="display:grid;grid-template-columns:1.5fr 1fr;gap:20px;margin-bottom:24px;">
    <div class="chart-card">
      <div class="chart-header">
        <h3>Goal Completion ‚Äî This Week</h3>
      </div>
      <canvas id="goalLineChart" height="120"></canvas>
    </div>
    <div class="chart-card">
      <div class="chart-header">
        <h3>Today's Progress</h3>
        <span class="chart-sub" id="progress-label">18 / 25 goals</span>
      </div>
      <div style="position:relative;width:160px;height:160px;margin:0 auto;">
        <canvas id="todayDoughnut"></canvas>
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
          <span style="font-size:32px;font-weight:800;color:#C59DD9">72%</span>
          <span style="font-size:11px;color:rgba(197,157,217,0.45);display:block">done</span>
        </div>
      </div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:16px;justify-content:center;">
        <span class="pill pill-green" style="font-size:11px">18 Done</span>
        <span class="pill pill-yellow" style="font-size:11px">7 Pending</span>
      </div>
    </div>
  </div>

  <!-- Goals Kanban -->
  <div class="goals-columns">
    <!-- Pending -->
    <div class="goal-column">
      <div class="goal-col-title">
        <span style="width:10px;height:10px;border-radius:50%;background:#f59e0b;display:inline-block"></span>
        Pending
        <span class="col-badge" style="background:rgba(245,158,11,0.2);color:#f59e0b" id="pending-badge">7</span>
      </div>
      <div id="pending-goals"></div>
    </div>

    <!-- In Progress -->
    <div class="goal-column">
      <div class="goal-col-title">
        <span style="width:10px;height:10px;border-radius:50%;background:#3b82f6;display:inline-block"></span>
        In Progress
        <span class="col-badge" style="background:rgba(59,130,246,0.2);color:#3b82f6">3</span>
      </div>
      <div class="goal-card">
        <div class="goal-card-title">System Design: Load Balancing</div>
        <div class="goal-card-meta">
          <span class="g-tag sd">SD</span>
          <span class="goal-card-date">Due: Today</span>
        </div>
      </div>
      <div class="goal-card">
        <div class="goal-card-title">Mock Interview Practice</div>
        <div class="goal-card-meta">
          <span class="g-tag hr">HR</span>
          <span class="goal-card-date">Due: Today</span>
        </div>
      </div>
      <div class="goal-card">
        <div class="goal-card-title">Revise Binary Search Trees</div>
        <div class="goal-card-meta">
          <span class="g-tag dsa">DSA</span>
          <span class="goal-card-date">Due: Today</span>
        </div>
      </div>
    </div>

    <!-- Done -->
    <div class="goal-column">
      <div class="goal-col-title">
        <span style="width:10px;height:10px;border-radius:50%;background:#22c55e;display:inline-block"></span>
        Completed
        <span class="col-badge" style="background:rgba(34,197,94,0.2);color:#22c55e" id="done-badge">18</span>
      </div>
      <div id="done-goals"></div>
    </div>
  </div>

  <!-- Consistency Heatmap -->
  <div class="chart-card" style="margin-top:24px;">
    <div class="chart-header">
      <h3>Consistency Heatmap</h3>
      <span class="chart-sub">Last 12 weeks of activity</span>
    </div>
    <div id="heatmap" style="display:flex;gap:4px;flex-wrap:nowrap;overflow-x:auto;padding-bottom:8px;margin-top:8px;"></div>
    <div style="display:flex;align-items:center;gap:8px;margin-top:12px;font-size:11px;color:rgba(197,157,217,0.45);">
      Less
      <div style="width:12px;height:12px;background:rgba(197,157,217,0.08);border-radius:3px"></div>
      <div style="width:12px;height:12px;background:rgba(255,107,53,0.3);border-radius:3px"></div>
      <div style="width:12px;height:12px;background:rgba(255,107,53,0.6);border-radius:3px"></div>
      <div style="width:12px;height:12px;background:#7A3F91;border-radius:3px"></div>
      More
    </div>
  </div>
</main>

<!-- Add Goal Modal -->
<div class="modal-overlay" id="modal">
  <div class="modal">
    <div class="modal-title">Add New Goal</div>
    <div class="form-group">
      <label class="form-label">Goal Title</label>
      <input type="text" class="form-input" id="goal-title" placeholder="e.g., Solve 3 LeetCode problems">
    </div>
    <div class="form-group">
      <label class="form-label">Category</label>
      <select class="form-select" id="goal-cat">
        <option value="dsa">DSA</option>
        <option value="sd">System Design</option>
        <option value="cs">CS Fundamentals</option>
        <option value="apt">Aptitude</option>
        <option value="hr">Soft Skills / HR</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">Priority</label>
      <select class="form-select" id="goal-priority">
        <option>High</option>
        <option>Medium</option>
        <option>Low</option>
      </select>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeModal()">Cancel</button>
      <button class="btn-primary" onclick="addGoal()">Add Goal</button>
    </div>
  </div>
</div>

<script>
// Charts
new Chart(document.getElementById('todayDoughnut'), {
  type: 'doughnut',
  data: {
    datasets: [{ data: [18, 7], backgroundColor: ['#7A3F91','rgba(197,157,217,0.08)'], borderWidth: 0 }]
  },
  options: { cutout: '72%', plugins: { legend: { display: false }, tooltip: { enabled: false } } }
});

new Chart(document.getElementById('goalLineChart'), {
  type: 'line',
  data: {
    labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
    datasets: [{
      label: 'Completed',
      data: [12, 18, 9, 22, 16, 25, 18],
      borderColor: '#7A3F91',
      backgroundColor: 'rgba(255,107,53,0.1)',
      fill: true,
      tension: 0.4,
      pointBackgroundColor: '#7A3F91'
    }, {
      label: 'Target',
      data: [20, 20, 20, 20, 20, 20, 20],
      borderColor: '#C59DD9',
      borderDash: [5,5],
      fill: false,
      pointRadius: 0
    }]
  },
  options: {
    plugins: { legend: { labels: { color: '#C59DD9', boxWidth: 10 } } },
    scales: {
      x: { grid: { display: false }, ticks: { color: 'rgba(197,157,217,0.45)' } },
      y: { grid: { color: 'rgba(197,157,217,0.08)' }, ticks: { color: 'rgba(197,157,217,0.45)' } }
    }
  }
});

// Goals Data
const GOALS_API = '/api/goals';
let goalsData = [];

async function loadGoals() {
  const res = await fetch(GOALS_API);
  goalsData = await res.json();
  renderGoals();
}

function renderGoals() {
  const pending = goalsData.filter(g => g.status === 'pending');
  const done = goalsData.filter(g => g.status === 'done');
  document.getElementById('pending-count').textContent = pending.length;
  document.getElementById('pending-badge').textContent = pending.length;
  document.getElementById('done-badge').textContent = done.length;

  document.getElementById('pending-goals').innerHTML = pending.map(g => `
    <div class="goal-card" onclick="markDone(${g.id})">
      <div class="goal-card-title">${g.title}</div>
      <div class="goal-card-meta">
        <span class="g-tag ${g.cat}">${g.cat.toUpperCase()}</span>
        <span class="goal-card-date">Click to complete</span>
      </div>
    </div>
  `).join('');

  document.getElementById('done-goals').innerHTML = done.map(g => `
    <div class="goal-card" style="opacity:0.5">
      <div class="goal-card-title" style="text-decoration:line-through">${g.title}</div>
      <div class="goal-card-meta">
        <span class="g-tag ${g.cat}">${g.cat.toUpperCase()}</span>
        <span style="margin-left:auto;font-size:11px;color:#22c55e">‚úì Done</span>
      </div>
    </div>
  `).join('');
}

async function markDone(id) {
  const g = goalsData.find(x => x.id === id);
  if (!g) return;
  g.status = 'done';
  await fetch(`${GOALS_API}/${id}`, {
    method: 'PUT',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ status: 'done' })
  });
  renderGoals();
}

function openModal() { document.getElementById('modal').classList.add('open'); }
function closeModal() { document.getElementById('modal').classList.remove('open'); }

async function addGoal() {
  const title = document.getElementById('goal-title').value;
  const cat = document.getElementById('goal-cat').value;
  if (!title) return;
  const res = await fetch(GOALS_API, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({ title, cat })
  });
  const goal = await res.json();
  goalsData.push(goal);
  renderGoals();
  closeModal();
  document.getElementById('goal-title').value = '';
}

loadGoals();

// Heatmap
const heatmap = document.getElementById('heatmap');
for (let w = 0; w < 12; w++) {
  const col = document.createElement('div');
  col.style.cssText = 'display:flex;flex-direction:column;gap:4px;';
  for (let d = 0; d < 7; d++) {
    const cell = document.createElement('div');
    const val = Math.random();
    const colors = ['rgba(197,157,217,0.08)','rgba(255,107,53,0.3)','rgba(255,107,53,0.6)','#7A3F91'];
    const c = val < 0.2 ? colors[0] : val < 0.5 ? colors[1] : val < 0.8 ? colors[2] : colors[3];
    cell.style.cssText = `width:14px;height:14px;background:${c};border-radius:3px;`;
    cell.title = `${Math.floor(val * 20)} goals`;
    col.appendChild(cell);
  }
  heatmap.appendChild(col);
}

</script>
<script src="theme-switcher.js"></script>
</body>
</html>